// Generated by IcedCoffeeScript 108.0.12
(function() {
  var common, fake_block, hash_block, prev_hash, result, _;

  _ = require('wegweg')({
    globals: true
  });

  common = require('./lib/common');

  hash_block = (function(data, prev_hash) {
    var char, hash_fn, hash_value, metadata, nibbles, _i, _j, _len, _len1, _ref;
    metadata = {
      data: data,
      prev_hash: prev_hash,
      fns: []
    };
    nibbles = prev_hash.slice(-20).split('');
    for (_i = 0, _len = nibbles.length; _i < _len; _i++) {
      char = nibbles[_i];
      metadata.fns.push(common.find_fn(char));
    }
    if (_.type(data) !== 'string') {
      data = JSON.stringify(data);
    }
    hash_value = common.sha256(data);
    _ref = metadata.fns;
    for (_j = 0, _len1 = _ref.length; _j < _len1; _j++) {
      hash_fn = _ref[_j];
      hash_value = common[hash_fn](hash_value);
      log("" + hash_fn + "()", hash_value);
    }
    hash_value = common.sha256(hash_value);
    return hash_value;
  });

  if (module.parent) {
    module.exports = hash_block;
  } else {
    fake_block = {
      height: 33,
      data: {
        lorem: 'ipsum'
      }
    };
    prev_hash = common.sha256('GENESIS');
    result = hash_block(fake_block, prev_hash);
    log('Block hash:', result);
  }

}).call(this);
